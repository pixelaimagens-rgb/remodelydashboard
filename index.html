<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remodely - Painel da Dona</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons via CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style type="text/tailwindcss">
        @layer base {
            body {
                font-family: 'Montserrat', sans-serif;
                background-color: #1a1a1a;
                color: #f0f0f0;
            }
        }
        @layer components {
            .sidebar {
                @apply bg-gradient-to-b from-gray-900 to-gray-800 text-gray-200 w-64 min-h-screen p-4 fixed top-0 left-0 z-30 transition-all duration-300;
            }
            .sidebar a {
                @apply block py-3 px-4 rounded-lg mb-2 transition-colors duration-200 flex items-center;
            }
            .sidebar a:hover, .sidebar a.active {
                @apply bg-gray-700 text-yellow-400;
            }
            .content-section {
                @apply bg-gray-800 rounded-xl shadow-lg p-6 mt-4;
            }
            .card {
                @apply bg-gray-700 rounded-xl shadow-md p-6 transition-transform duration-200 hover:shadow-xl hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center;
            }
            .btn-secondary {
                @apply bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200;
            }
            .btn-success {
                @apply bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200;
            }
            .btn-danger {
                @apply bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200;
            }
            .input-field {
                @apply bg-gray-600 text-white border border-gray-500 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-colors duration-200;
            }
            .table {
                @apply min-w-full divide-y divide-gray-600;
            }
            .table th {
                @apply px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider;
            }
            .table td {
                @apply px-4 py-3 whitespace-nowrap text-sm text-gray-200;
            }
            .status-ativo {
                @apply text-green-400;
            }
            .status-inativo {
                @apply text-red-400;
            }
            .status-potencial {
                @apply text-yellow-400;
            }
            .status-em-tratamento {
                @apply text-blue-400;
            }
            .status-agendado {
                @apply text-blue-400;
            }
            .status-realizado {
                @apply text-green-400;
            }
            .status-cancelado {
                @apply text-red-400;
            }
            .notification {
                @apply fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm transform transition-transform duration-300 opacity-0 translate-x-full;
            }
            .notification.show {
                @apply opacity-100 translate-x-0;
            }
            .notification.success {
                @apply bg-green-600 text-white;
            }
            .notification.error {
                @apply bg-red-600 text-white;
            }
            .notification.info {
                @apply bg-blue-600 text-white;
            }
            .notification.warning {
                @apply bg-yellow-600 text-white;
            }
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="text-2xl font-bold mb-10 text-center text-yellow-400 flex items-center justify-center">
            <i data-lucide="spa" class="mr-2"></i> Remodely
        </div>
        <nav>
            <a href="#" class="active flex items-center" onclick="showSection('dashboard-section')">
                <i data-lucide="layout-dashboard" class="mr-2"></i> Dashboard
            </a>
            <a href="#" class="flex items-center" onclick="showSection('clientes-section')">
                <i data-lucide="users" class="mr-2"></i> Clientes
            </a>
            <a href="#" class="flex items-center" onclick="showSection('agendamentos-section')">
                <i data-lucide="calendar" class="mr-2"></i> Agendamentos
            </a>
            <a href="#" class="flex items-center" onclick="showSection('servicos-section')">
                <i data-lucide="scissors" class="mr-2"></i> Serviços
            </a>
            <a href="#" class="flex items-center" onclick="showSection('relatorios-section')">
                <i data-lucide="bar-chart-3" class="mr-2"></i> Relatórios
            </a>
            <a href="#" class="flex items-center" onclick="showSection('configuracoes-section')">
                <i data-lucide="settings" class="mr-2"></i> Configurações
            </a>
        </nav>
    </div>
    <!-- Main Content -->
    <div class="ml-64 p-6">
        <div class="notification" id="notification"></div>
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="content-section">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center">
                <i data-lucide="trending-up" class="mr-2 text-yellow-400"></i> Dashboard
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="card bg-gradient-to-r from-green-600 to-emerald-700 text-white">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Total de Clientes</h3>
                        <i data-lucide="users" class="text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mt-2" id="totalClientsCount">0</p>
                </div>
                <div class="card bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Agendamentos Hoje</h3>
                        <i data-lucide="calendar-check" class="text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mt-2" id="todaysAppointmentsCount">0</p>
                </div>
                <div class="card bg-gradient-to-r from-purple-600 to-fuchsia-700 text-white">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Clientes Ativos</h3>
                        <i data-lucide="user-check" class="text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mt-2" id="activeClientsCount">0</p>
                </div>
                <div class="card bg-gradient-to-r from-yellow-600 to-amber-700 text-gray-900">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Receita do Mês</h3>
                        <i data-lucide="dollar-sign" class="text-2xl"></i>
                    </div>
                    <p class="text-3xl font-bold mt-2" id="monthlyRevenue">R$ 0,00</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-xl font-semibold text-gray-100 mb-4 flex items-center">
                        <i data-lucide="clock" class="mr-2 text-blue-400"></i> Próximos Agendamentos
                    </h3>
                    <div id="upcomingAppointmentsList">
                        <p class="text-gray-400">Carregando...</p>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-xl font-semibold text-gray-100 mb-4 flex items-center">
                        <i data-lucide="user-plus" class="mr-2 text-green-400"></i> Clientes Recentes
                    </h3>
                    <div id="recentClientsList">
                        <p class="text-gray-400">Carregando...</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- Clientes Section -->
        <section id="clientes-section" class="content-section hidden">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center">
                <i data-lucide="users" class="mr-2 text-yellow-400"></i> Gerenciar Clientes
            </h2>
            <div class="flex justify-between mb-6">
                <button class="btn-primary" onclick="openModal('clientModal')">
                    <i data-lucide="plus" class="mr-2"></i> Adicionar Cliente
                </button>
                <div class="flex">
                    <input type="text" id="searchClients" class="input-field w-64" placeholder="Buscar cliente...">
                    <button class="btn-secondary ml-2" onclick="searchClients()">
                        <i data-lucide="search"></i>
                    </button>
                </div>
            </div>
            <div class="card">
                <div class="overflow-x-auto">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <tr><td colspan="5" class="text-center text-gray-400">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        <!-- Agendamentos Section -->
        <section id="agendamentos-section" class="content-section hidden">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center">
                <i data-lucide="calendar" class="mr-2 text-yellow-400"></i> Gerenciar Agendamentos
            </h2>
            <div class="flex justify-between mb-6">
                <button class="btn-primary" onclick="openModal('appointmentModal')">
                    <i data-lucide="plus" class="mr-2"></i> Adicionar Agendamento
                </button>
                <div class="flex">
                    <input type="date" id="filterDate" class="input-field mr-2">
                    <button class="btn-secondary" onclick="filterAppointments()">Filtrar por Data</button>
                </div>
            </div>
            <div class="card">
                <div class="overflow-x-auto">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Horário</th>
                                <th>Cliente</th>
                                <th>Serviço</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="appointmentsTableBody">
                            <tr><td colspan="6" class="text-center text-gray-400">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        <!-- Serviços Section -->
        <section id="servicos-section" class="content-section hidden">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center">
                <i data-lucide="scissors" class="mr-2 text-yellow-400"></i> Gerenciar Serviços
            </h2>
            <div class="flex justify-between mb-6">
                <button class="btn-primary" onclick="openModal('serviceModal')">
                    <i data-lucide="plus" class="mr-2"></i> Adicionar Serviço
                </button>
            </div>
            <div class="card">
                <div class="overflow-x-auto">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Descrição</th>
                                <th>Duração (min)</th>
                                <th>Preço (R$)</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="servicesTableBody">
                            <tr><td colspan="6" class="text-center text-gray-400">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        <!-- Relatórios Section -->
        <section id="relatorios-section" class="content-section hidden">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center">
                <i data-lucide="bar-chart-3" class="mr-2 text-yellow-400"></i> Relatórios
            </h2>
            <div class="card p-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-100 mb-4">Faturamento por Mês</h3>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
            <div class="card p-6">
                <h3 class="text-xl font-semibold text-gray-100 mb-4">Novos Clientes por Mês</h3>
                <div class="chart-container">
                    <canvas id="newClientsChart"></canvas>
                </div>
            </div>
        </section>
        <!-- Configurações Section -->
        <section id="configuracoes-section" class="content-section hidden">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center">
                <i data-lucide="settings" class="mr-2 text-yellow-400"></i> Configurações
            </h2>
            <div class="card space-y-6">
                <div>
                    <h3 class="text-xl font-semibold text-gray-100 mb-4">Perfil da Clínica</h3>
                    <form class="space-y-4">
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Nome da Clínica</label>
                            <input type="text" class="input-field w-full" value="Clínica Remodely">
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Telefone</label>
                            <input type="text" class="input-field w-full" value="(11) 98765-4321">
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">E-mail</label>
                            <input type="email" class="input-field w-full" value="contato@remodely.com.br">
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Endereço</label>
                            <input type="text" class="input-field w-full" value="Av. Paulista, 1000 - São Paulo">
                        </div>
                        <button class="btn-primary">Salvar</button>
                    </form>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-gray-100 mb-4">Usuários</h3>
                    <p class="text-gray-400 mb-4">Funcionalidade para adicionar/remover profissionais e definir permissões (requer back-end).</p>
                    <button class="btn-secondary">Gerenciar Usuários</button>
                </div>
            </div>
        </section>
        <!-- Modals -->
        <div id="clientModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-800 rounded-xl p-6 w-11/12 max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-100" id="clientModalTitle">Adicionar Novo Cliente</h3>
                    <button class="text-gray-400 hover:text-gray-200" onclick="closeModal('clientModal')">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <form class="space-y-4" id="clientForm">
                    <input type="hidden" id="clientId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Nome *</label>
                            <input type="text" id="clientName" class="input-field" required>
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Telefone *</label>
                            <input type="text" id="clientPhone" class="input-field" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">E-mail</label>
                        <input type="email" id="clientEmail" class="input-field">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Status</label>
                            <select id="clientStatus" class="input-field">
                                <option value="Ativo">Ativo</option>
                                <option value="Inativo">Inativo</option>
                                <option value="Potencial">Potencial</option>
                                <option value="Em Tratamento">Em Tratamento</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Altura (cm)</label>
                            <input type="number" id="clientHeight" class="input-field">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Peso (kg)</label>
                            <input type="number" id="clientWeight" class="input-field">
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Doenças Preexistentes</label>
                            <input type="text" id="clientDiseases" class="input-field">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Alergias</label>
                            <input type="text" id="clientAllergies" class="input-field">
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Observações</label>
                        <textarea id="clientNotes" class="input-field"></textarea>
                    </div>
                    <div class="flex justify-end space-x-4 mt-6">
                        <button type="button" class="btn-secondary" onclick="closeModal('clientModal')">Cancelar</button>
                        <button type="submit" class="btn-primary">Salvar Cliente</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="appointmentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-800 rounded-xl p-6 w-11/12 max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-100" id="appointmentModalTitle">Adicionar Novo Agendamento</h3>
                    <button class="text-gray-400 hover:text-gray-200" onclick="closeModal('appointmentModal')">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <form class="space-y-4" id="appointmentForm">
                    <input type="hidden" id="appointmentId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Cliente *</label>
                            <select id="appointmentClient" class="input-field" required>
                                <!-- Preenchido dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Serviço *</label>
                            <select id="appointmentService" class="input-field" required>
                                <!-- Preenchido dinamicamente -->
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Data *</label>
                            <input type="date" id="appointmentDate" class="input-field" required>
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Horário *</label>
                            <input type="time" id="appointmentTime" class="input-field" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Status</label>
                        <select id="appointmentStatus" class="input-field">
                            <option value="Agendado">Agendado</option>
                            <option value="Realizado">Realizado</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Observações</label>
                        <textarea id="appointmentNotes" class="input-field"></textarea>
                    </div>
                    <div class="flex justify-end space-x-4 mt-6">
                        <button type="button" class="btn-secondary" onclick="closeModal('appointmentModal')">Cancelar</button>
                        <button type="submit" class="btn-primary">Salvar Agendamento</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="serviceModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-800 rounded-xl p-6 w-11/12 max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-100" id="serviceModalTitle">Adicionar Novo Serviço</h3>
                    <button class="text-gray-400 hover:text-gray-200" onclick="closeModal('serviceModal')">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <form class="space-y-4" id="serviceForm">
                    <input type="hidden" id="serviceId">
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Nome *</label>
                        <input type="text" id="serviceName" class="input-field" required>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Descrição</label>
                        <textarea id="serviceDescription" class="input-field"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Duração (min) *</label>
                            <input type="number" id="serviceDuration" class="input-field" required>
                        </div>
                        <div>
                            <label class="block text-gray-300 text-sm font-medium mb-2">Preço (R$) *</label>
                            <input type="number" id="servicePrice" class="input-field" step="0.01" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Status</label>
                        <select id="serviceStatus" class="input-field">
                            <option value="Ativo">Ativo</option>
                            <option value="Inativo">Inativo</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-4 mt-6">
                        <button type="button" class="btn-secondary" onclick="closeModal('serviceModal')">Cancelar</button>
                        <button type="submit" class="btn-primary">Salvar Serviço</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÃO ---
        // *********** IMPORTANTE: Substitua esta URL pelo URL real do seu backend hospedado no Railway! ***********
        const API_BASE_URL = 'https://SEU_BACKEND_RAILWAY_URL/api';
        // Exemplo: const API_BASE_URL = 'https://remodely-abc123-production.up.railway.app/api';
        // *********** IMPORTANTE: Substitua esta URL pelo URL real do seu frontend hospedado no Netlify! ***********
        const FRONTEND_URL = 'https://SEU_FRONTEND_NETLIFY_URL/';
        // Exemplo: const FRONTEND_URL = 'https://remodelyadm.netlify.app/';

        // Inicializa os ícones Lucide
        lucide.createIcons();

        // --- FUNÇÕES DE NOTIFICAÇÃO ---
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // --- FUNÇÕES DE NAVEGAÇÃO ---
        function showSection(sectionId) {
            // Esconde todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            // Remove a classe 'active' de todos os links
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            // Mostra a seção selecionada
            document.getElementById(sectionId).classList.remove('hidden');
            // Adiciona a classe 'active' ao link clicado
            // O 'event' pode ser undefined em chamadas diretas, então verificamos
            if (event && event.target) {
                 event.target.classList.add('active');
            }
            // Carrega dados específicos da seção
            if (sectionId === 'dashboard-section') {
                loadDashboardData();
            } else if (sectionId === 'clientes-section') {
                loadClients();
            } else if (sectionId === 'agendamentos-section') {
                loadAppointments();
                loadClientsForSelect();
                loadServicesForSelect();
            } else if (sectionId === 'servicos-section') {
                loadServices();
            }
        }

        // --- FUNÇÕES DE MODAL ---
        function openModal(modalId, data = null) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            if (modalId === 'clientModal' && data) {
                document.getElementById('clientId').value = data._id;
                document.getElementById('clientName').value = data.name;
                document.getElementById('clientPhone').value = data.phone;
                document.getElementById('clientEmail').value = data.email;
                document.getElementById('clientStatus').value = data.status;
                document.getElementById('clientHeight').value = data.height || '';
                document.getElementById('clientWeight').value = data.weight || '';
                document.getElementById('clientDiseases').value = data.diseases || '';
                document.getElementById('clientAllergies').value = data.allergies || '';
                document.getElementById('clientNotes').value = data.notes || '';
                document.getElementById('clientModalTitle').textContent = 'Editar Cliente';
            } else if (modalId === 'clientModal') {
                document.getElementById('clientForm').reset();
                document.getElementById('clientId').value = '';
                document.getElementById('clientModalTitle').textContent = 'Adicionar Novo Cliente';
            } else if (modalId === 'appointmentModal' && data) {
                document.getElementById('appointmentId').value = data._id;
                document.getElementById('appointmentClient').value = data.client._id || data.client;
                document.getElementById('appointmentService').value = data.service._id || data.service;
                document.getElementById('appointmentDate').value = new Date(data.date).toISOString().split('T')[0];
                document.getElementById('appointmentTime').value = data.time;
                document.getElementById('appointmentStatus').value = data.status;
                document.getElementById('appointmentNotes').value = data.notes || '';
                document.getElementById('appointmentModalTitle').textContent = 'Editar Agendamento';
            } else if (modalId === 'appointmentModal') {
                document.getElementById('appointmentForm').reset();
                document.getElementById('appointmentId').value = '';
                document.getElementById('appointmentModalTitle').textContent = 'Adicionar Novo Agendamento';
            } else if (modalId === 'serviceModal' && data) {
                document.getElementById('serviceId').value = data._id;
                document.getElementById('serviceName').value = data.name;
                document.getElementById('serviceDescription').value = data.description;
                document.getElementById('serviceDuration').value = data.duration;
                document.getElementById('servicePrice').value = data.price;
                document.getElementById('serviceStatus').value = data.status;
                document.getElementById('serviceModalTitle').textContent = 'Editar Serviço';
            } else if (modalId === 'serviceModal') {
                document.getElementById('serviceForm').reset();
                document.getElementById('serviceId').value = '';
                document.getElementById('serviceModalTitle').textContent = 'Adicionar Novo Serviço';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // --- FUNÇÕES DE AUTENTICAÇÃO ---
        function setAuthToken(token) {
            localStorage.setItem('authToken', token);
        }
        function getAuthToken() {
            return localStorage.getItem('authToken');
        }
        function isAuthenticated() {
            return !!getAuthToken();
        }

        async function apiRequest(endpoint, options = {}) {
            const token = getAuthToken();
            if (!options.headers) {
                options.headers = {};
            }
            if (token) {
                options.headers['Authorization'] = `Bearer ${token}`;
            }
            options.headers['Content-Type'] = 'application/json';
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                if (!response.ok) {
                    if (response.status === 401) {
                        localStorage.removeItem('authToken');
                        window.location.href = `${FRONTEND_URL}/login.html`;
                        showNotification('Sessão expirada. Faça login novamente.', 'error');
                        return null;
                    }
                    throw new Error(`Erro na API: ${response.status} - ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Erro na requisição API:', error);
                showNotification(`Erro na comunicação com o servidor: ${error.message}`, 'error');
                return null;
            }
        }

        // --- FUNÇÕES DE CLIENTES ---
        async function loadClients() {
            const response = await apiRequest('/clients');
            if (response) {
                const tbody = document.getElementById('clientsTableBody');
                tbody.innerHTML = '';
                if (response.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-400">Nenhum cliente encontrado.</td></tr>';
                    return;
                }
                response.forEach(client => {
                    const row = document.createElement('tr');
                    const statusClass = `status-${client.status.toLowerCase().replace(' ', '-')}`;
                    row.innerHTML = `
                        <td class="font-medium">${client.name}</td>
                        <td>${client.phone}</td>
                        <td>${client.email || 'N/A'}</td>
                        <td><span class="${statusClass}">${client.status}</span></td>
                        <td>
                            <button class="btn-primary mr-2" onclick="viewClient('${client._id}')"><i data-lucide="eye" class="w-4 h-4"></i></button>
                            <button class="btn-primary mr-2" onclick="editClient('${client._id}')"><i data-lucide="edit" class="w-4 h-4"></i></button>
                            <button class="btn-danger" onclick="deleteClient('${client._id}')"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                lucide.createIcons(); // Atualiza ícones após adicionar novos elementos
            }
        }

        async function addClient(clientData) {
            const response = await apiRequest('/clients', {
                method: 'POST',
                body: JSON.stringify(clientData)
            });
            if (response) {
                showNotification('Cliente adicionado com sucesso!', 'success');
                loadClients();
                closeModal('clientModal');
            }
        }

        async function updateClient(id, clientData) {
            const response = await apiRequest(`/clients/${id}`, {
          
